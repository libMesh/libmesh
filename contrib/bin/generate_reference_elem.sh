#!/bin/sh

usage()
{
    echo "Usage: $0 dirname (outfile)"
    exit 1    
}

if test $# -eq 0; then
    usage "$0"
fi
if test $# -gt 2; then
    usage "$0"
fi
  

filelist=$(find "$1" -type f -name "*.xda" | LC_COLLATE=POSIX sort)

genfile="genfile.C"

if test $# -eq 2; then
    genfile=$2
fi

echo "Writing results to $genfile"

#echo $filelist

cat <<EOF > "$genfile"
// THIS FILE IS AUTOMATICALLY GENERATED -- DO NOT EDIT
// $genfile automatically created by
// $0 $@
// in directory $(pwd)

  typedef std::map<ElemType, std::string> FileMapType;
  FileMapType ref_elem_file;


EOF

for file in $filelist; do
    elem_type=$(basename "$file" .xda)

    echo "static const char* $elem_type =" >> "$genfile"

    # loop over each line in the file
    while read -r p; do
        printf '%s\n' "\"$p\\n\"" >> "$genfile"
    done < "$file"
    {
    echo ";"
    echo ""
    echo ""
    } >> "$genfile"
done
